<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>จัดการผู้ใช้ - ผู้ดูแลระบบ</title>
  <link rel="stylesheet" href="../../css/main.css">
</head>
<body>
    <!-- Banner Header -->
    <div class="banner">
        <div class="banner-content">
            <div class="banner-left">
                <div class="logo">IT</div>
                <div class="banner-text">
                    <h1>ระบบจัดการโครงงานพิเศษและสหกิจศึกษา</h1>
                    <p>ภาควิชาเทคโนโลยีสารสนเทศ คณะเทคโนโลยีและการจัดการอุตสาหกรรม</p>
                </div>
            </div>
            <div class="banner-user">
                <div class="user-avatar">A</div>
                <div class="user-name">Admin</div>
                <a href="../log_sing/login.html" class="logout-btn">ออกจากระบบ</a>
            </div>
        </div>
    </div>

    <div class="main-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                เมนู - ผู้ดูแลระบบ
            </div>
                <ul class="sidebar-menu">
                    <li><a href="dashbroadadmin.html">
                        <div class="icon"></div>
                        แดชบอร์ดระบบ
                        </a></li>
                    <li><a href="user-management.html" class="active">
                        <div class="icon"></div>
                        จัดการผู้ใช้
                    </a></li>
                    <li><a href="project-management.html">
                        <div class="icon"></div>
                        จัดการโครงงาน
                    </a></li>
                    <li><a href="committee-assignment.html">
                        <div class="icon"></div>
                        จัดการกรรมการสอบ
                    </a></li>
                </ul>
        </aside>

        <main class="content">
            <div class="content-header">
                <h2>จัดการผู้ใช้</h2>
            </div>

            <div class="content-body-admin">
                <!-- ฟิลเตอร์ -->
                <div class="dropdown-row">
                    <div class="controls-bar-admin">
                        <div class="filter-area">
                            <label class="filter-label-major">สาขา</label>
                            <select id="filterProgram" class="major-select">
                                <option value="">-- ทั้งหมด --</option>
                                <option>IT</option>
                                <option>ITI</option>
                                <option>ITT</option>
                                <option>INET</option>
                                <option>NET</option>
                            </select>

                            <label class="filter-label-role">ประเภท</label>
                            <select id="filterRole" class="role-select">
                                <option value="">-- ทั้งหมด --</option>
                                <option value="student">นักศึกษา</option>
                                <option value="teacher">อาจารย์</option>
                                <option value="commit">กรรมการ</option>
                            </select>

                            <label class="filter-label-find">ค้นหา</label>
                            <input type="text" id="searchInput" class="searchInput" placeholder="ค้นหาชื่อหรือรหัส">
                        </div>
                    </div>
                </div>


                <!-- ตารางผู้ใช้ -->
                <div class="info-section">
                    <h3>รายการผู้ใช้</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>รหัส</th>
                                <th>ชื่อ-สกุล</th>
                                <th>ตำแหน่ง</th>
                                <th>สาขา</th>
                                <th>สถานะ</th>
                                <th>การทำงาน</th>
                            </tr>
                        </thead>
                        <tbody id="userTable">
                            <tr>
                                <td>6806022510122</td>
                                <td>นางสาวไรบีนา มะเก๊ะ</td>
                                <td>นักศึกษา</td>
                                <td>INET</td>
                                <td class="status active">Active</td>
                                <td>
                                    <button onclick="editUser(this)">แก้ไข</button>
                                    <button onclick="toggleStatus(this)">ปิดการใช้งาน</button>
                                    <button onclick="deleteUser(this)">ลบ</button>
                                </td>
                            </tr>
                            <tr>
                                <td>6806022510634</td>
                                <td>นายคฤษฐ์ เสือเดช</td>
                                <td>นักศึกษา</td>
                                <td>INET</td>
                                <td class="status active">Active</td>
                                <td>
                                    <button onclick="editUser(this)">แก้ไข</button>
                                    <button onclick="toggleStatus(this)">ปิดการใช้งาน</button>
                                    <button onclick="deleteUser(this)">ลบ</button>
                                </td>
                            </tr>
                            <tr>
                                <td>6806022510653</td>
                                <td>นางสาวชาลิสา ยิ้มลำใย</td>
                                <td>นักศึกษา</td>
                                <td>INET</td>
                                <td class="status active">Active</td>
                                <td>
                                    <button onclick="editUser(this)">แก้ไข</button>
                                    <button onclick="toggleStatus(this)">ปิดการใช้งาน</button>
                                    <button onclick="deleteUser(this)">ลบ</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="pagination-container">
                <div class="pagination">
                    <a href="#" class="page-link prev-next-link" data-page="prev">&lt;</a>
                    <a href="#" class="page-link active" data-page="1">1</a>
                    <a href="#" class="page-link" data-page="2">2</a>
                    <a href="#" class="page-link" data-page="3">3</a>
                    <a href="#" class="page-link" data-page="4">4</a>
                    <a href="#" class="page-link prev-next-link" data-page="next">&gt;</a>
                </div>
            </div>
            
        </main>
    </div>

    <!-- Modal -->
    <div id="userModal" class="admin-modal">
        <div class="admin-modal-content">
        <h3>แก้ไข ผู้ใช้</h3>
        <form id="userForm" name="userForm">
            <div class="form-grid">
            <input name="username" placeholder="รหัสนักศึกษา" required />
            <input name="fullname" placeholder="ชื่อ-สกุล" required />
            <select name="role" required>
                <option value="student">นักศึกษา</option>
                <option value="teacher">อาจารย์</option>
                <option value="commit">กรรมการ</option>
            </select>
            <select name="program" required>
                <option>IT</option><option>ITI</option><option>INET</option><option>NET</option><option>ITT</option>
            </select>
            </div>
            <div class="form-actions">
            <button type="button" onclick="closeUserModal()">ยกเลิก</button>
            <button type="submit">บันทึก</button>
            </div>
        </form>
        </div>
    </div>

    <!-- Confirm Delete Modal -->
    <div id="confirmModal" class="confirm-modal">
    <div class="confirm-modal-content">
        <h3>ยืนยันการลบ</h3>
        <p id="confirmMessage">คุณต้องการลบผู้ใช้นี้หรือไม่?</p>
        <div class="confirm-actions">
        <button class="btn-cancel" onclick="closeConfirmModal()">ยกเลิก</button>
        <button class="btn-confirm" onclick="confirmDelete()">ยืนยัน</button>
        </div>
    </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <p>&copy; 2025 ภาควิชาเทคโนโลยีสารสนเทศ คณะเทคโนโลยีและการจัดการอุตสาหกรรม</p>
        <p>ระบบจัดการโครงงานพิเศษและสหกิจศึกษา</p>
        <div class="footer-links">
            <a href="/help">ช่วยเหลือ</a>
            <a href="/contact">ติดต่อ</a>
            <a href="/privacy">นโยบายความเป็นส่วนตัว</a>
        </div>
    </footer>
    
    <script>
        const userTable = document.getElementById('userTable');
        let editingRow = null;
        let targetDeleteRow = null; // เก็บแถวที่รอลบ

        function roleText(role){
            if(role === "student") return "นักศึกษา";
            if(role === "teacher") return "อาจารย์";
            if(role === "admin") return "ผู้ดูแลระบบ";
            return role;
        }

        function closeUserModal(){ 
            document.getElementById('userModal').style.display = 'none'; 
        }

        document.getElementById('userForm').addEventListener('submit', (e)=> {
            e.preventDefault();
            const data = Object.fromEntries(new FormData(e.target).entries());
            if(editingRow){
            editingRow.cells[0].textContent = data.username;
            editingRow.cells[1].textContent = data.fullname;
            editingRow.cells[2].textContent = roleText(data.role);
            editingRow.cells[3].textContent = data.program;
            }
            closeUserModal();
        });

        function editUser(btn){
            editingRow = btn.closest('tr');
            const cells = editingRow.cells;
            document.userForm.username.value = cells[0].textContent;
            document.userForm.fullname.value = cells[1].textContent;
            document.userForm.role.value = 
                                        cells[2].textContent === "นักศึกษา" ? "student" :
                                        cells[2].textContent === "อาจารย์" ? "teacher" :
                                        cells[2].textContent === "กรรมการ" ? "commit" : "admin";
            document.userForm.program.value = cells[3].textContent;
            document.getElementById('userModal').style.display = 'flex';
        }

        function toggleStatus(btn){
            const row = btn.closest('tr');
            const statusCell = row.querySelector('.status');
            if(statusCell.textContent === "Active"){
            statusCell.textContent = "Inactive";
            statusCell.className = "status inactive";
            btn.textContent = "เปิดการใช้งาน";
            } else {
            statusCell.textContent = "Active";
            statusCell.className = "status active";
            btn.textContent = "ปิดการใช้งาน";
            }
        }

        // ---------- ส่วนยืนยันการลบ ----------
        function deleteUser(btn){
            targetDeleteRow = btn.closest('tr');
            const name = targetDeleteRow.cells[1].textContent; // ดึงชื่อผู้ใช้
            document.getElementById('confirmMessage').textContent = `คุณต้องการลบผู้ใช้ "${name}" หรือไม่?`;
            document.getElementById('confirmModal').style.display = 'flex';
        }

        function confirmDelete(){
            if (targetDeleteRow) {
            targetDeleteRow.remove();
            targetDeleteRow = null;
            }
            closeConfirmModal();
        }

        function closeConfirmModal(){
            document.getElementById('confirmModal').style.display = 'none';
        }
        // ------------------------------------

        function filterTable(){
            const program = document.getElementById('filterProgram').value;
            const role = document.getElementById('filterRole').value;
            const search = document.getElementById('searchInput').value.toLowerCase();

            Array.from(userTable.rows).forEach(row=>{
            const username = row.cells[0].textContent.toLowerCase();
            const fullname = row.cells[1].textContent.toLowerCase();
            const roleCell = row.cells[2].textContent;
            const programCell = row.cells[3].textContent;

            let match = true;
            if(program && programCell !== program) match = false;
            if(role && roleCell !== roleText(role)) match = false;
            if(search && !fullname.includes(search) && !username.includes(search)) match = false;

            row.style.display = match ? "" : "none";
            });
        }

        document.getElementById('filterProgram').addEventListener('change', filterTable);
        document.getElementById('filterRole').addEventListener('change', filterTable);
        document.getElementById('searchInput').addEventListener('input', filterTable);
        </script>


    
</body>
</html>
